package fr.acinq.lightning.serialization

import fr.acinq.lightning.CltvExpiryDelta
import fr.acinq.lightning.Lightning
import fr.acinq.lightning.blockchain.BITCOIN_FUNDING_DEPTHOK
import fr.acinq.lightning.blockchain.WatchEventConfirmed
import fr.acinq.lightning.channel.*
import fr.acinq.lightning.channel.TestsHelper.processEx
import fr.acinq.lightning.channel.states.WaitForFundingConfirmedTestsCommon
import fr.acinq.lightning.tests.TestConstants
import fr.acinq.lightning.utils.UUID
import fr.acinq.lightning.utils.msat
import fr.acinq.lightning.wire.FundingLocked
import fr.acinq.lightning.wire.UpdateAddHtlc
import fr.acinq.secp256k1.Hex
import kotlin.test.Ignore
import kotlin.test.Test
import kotlin.test.assertTrue

class CompatibilityTestsCommon {
    @Ignore
    fun `generate data`() {
        // generate test data
        val (alice, bob) = WaitForFundingConfirmedTestsCommon.init(ChannelType.SupportedChannelType.AnchorOutputs, TestConstants.fundingAmount, TestConstants.pushMsat)
        val fundingTx = alice.fundingTx!!
        val bin = Serialization.encrypt(TestConstants.Bob.nodeParams.nodePrivateKey, bob)
        println("wait_for_funding_confirmed: ${bin.data}")

        val (bob1, actionsBob) = bob.processEx(ChannelEvent.WatchReceived(WatchEventConfirmed(bob.channelId, BITCOIN_FUNDING_DEPTHOK, 42, 0, fundingTx)))
        val fundingLocked = actionsBob.findOutgoingMessage<FundingLocked>()
        assertTrue(bob1 is WaitForFundingLocked)

        val bin1 = Serialization.encrypt(TestConstants.Bob.nodeParams.nodePrivateKey, bob1)
        println("wait_for_funding_locked: ${bin1.data}")

        val (alice1, actionsAlice) = alice.processEx(ChannelEvent.MessageReceived(fundingLocked))
        assertTrue(alice1 is WaitForFundingConfirmed && alice1.deferred == fundingLocked)

        assertTrue(actionsAlice.isEmpty()) // alice waits until she sees on-chain confirmations herself
        val (alice2, actionsAlice2) = alice1.processEx(ChannelEvent.WatchReceived(WatchEventConfirmed(alice.channelId, BITCOIN_FUNDING_DEPTHOK, 0, 42, fundingTx)))
        val fundingLockedAlice = actionsAlice2.findOutgoingMessage<FundingLocked>()
        val (bob2, _) = bob1.processEx(ChannelEvent.MessageReceived(fundingLockedAlice))
        assertTrue(bob2 is Normal)

        val bin2 = Serialization.encrypt(TestConstants.Bob.nodeParams.nodePrivateKey, bob2)
        println("normal: ${bin2.data}")

        val add1 = CMD_ADD_HTLC(
            10_000.msat,
            Lightning.randomBytes32(),
            CltvExpiryDelta(144).toCltvExpiry(TestConstants.defaultBlockHeight.toLong()),
            TestConstants.emptyOnionPacket,
            UUID.randomUUID()
        )
        val add2 = CMD_ADD_HTLC(
            10_000.msat,
            Lightning.randomBytes32(),
            CltvExpiryDelta(144).toCltvExpiry(TestConstants.defaultBlockHeight.toLong()),
            TestConstants.emptyOnionPacket,
            UUID.randomUUID()
        )
        val (alice3, actionsAlice3) = alice2.processEx(ChannelEvent.ExecuteCommand(add1))
        val (_, actionsAlice4) = alice3.processEx(ChannelEvent.ExecuteCommand(add2))
        val htlc1 = actionsAlice3.findOutgoingMessage<UpdateAddHtlc>()
        val htlc2 = actionsAlice4.findOutgoingMessage<UpdateAddHtlc>()

        val (bob3, _) = bob2.processEx(ChannelEvent.MessageReceived(htlc1))
        val (bob4, _) = bob3.processEx(ChannelEvent.MessageReceived(htlc2))
        val (bob5, _) = bob4.processEx(ChannelEvent.ExecuteCommand(add1))
        val (bob6, _) = bob5.processEx(ChannelEvent.ExecuteCommand(add2))
        assertTrue(bob6 is Normal)

        val bin3 = Serialization.encrypt(TestConstants.Bob.nodeParams.nodePrivateKey, bob6)
        println("normal_with_htlcs: ${bin3.data}")
    }

    @Test
    fun `read compatibility test data`() {
        // data was generated with lightning-kmp v1.0-beta11
        // README: it this test fails it means that we cannot decrypt and/or deserialize data created with on older version of the app !!
        val wait_for_funding_confirmed = Hex.decode(
            "2d0cef30160b00f8c206f1e0618f597b774b67338a1a52f4e1d13616a4032719bfb41817e7272b215afcc9d68e64fa46c94fa75f5b1c374832891a7ce4d326ec6cbd7cc3a9c876a9df0254b1306d02ef4755cf6a292dd643ee90cffa111b4a20b46c060d985ebb7618bf5c1d1d05b6c2e6535d3bf0f25e2bbae396dc2bca66e390d18ef46965d6986835cfa602728763adf74cde41924c609b41fef839b3eba6b514b5c70bbc5c58159122381407cce35643143aff68bef046a13a208cc4ee738b2b943e85d85004d94b014609c1876a48694e9b4ad92ceaa40094901c183103af1a25a35d6c38128921d53dfac1ed121ca6acd3dc66bdb90603d2f6cfb790303afcea3dd4b5a3f80c1ddb8abcac2fad767c91bd1f072bbf6269a79d210e2a8f16cd030ffc297c3ad746c21969c48a602acbc5b05aaf3875f91e0186428128f81a73bc872d144d36840c5dc51378911c06638d3d4b85193ce7e72a656f2592c862910b9e34f79e6173996e87b7a62f8637d62407da219823f6d5c3b13f30c0995f7a6eac5febfd16d4c7b8c389beef57ee9e44b731d25a3a9fb3fbfdd02884136bed9ee8c975b276c0dd9fb1b37dc4ce8a3c4fa674a6724384c5616b0c8b86f52bd66b0b5e1cc6d8c8e4fe0f818a4e5d9bc04f1fee5f2b63af5eee8340adea0654058058fcd16b6ef4d2c8154e2df4fa142fe289f26ddb77dc8da98401f4a7d47f8398977292858bc0092e9dfc1d3c1d621938f4d5fd4e36c7637a0773a0f1b546357e330c61fee88dd273e956f45133a765da823f2686b15ceadc84048a4dbaf0a9e83e6ff06bff586e6734b3a4e4a8511369c07f88f1efd548c1fff2d1d0aecfe1504232548cfae442249fc5d066aa93e442b511de05eb2be87595922be69e655c1048889ff10b1fc5047e7537f5db225a95049db32f885016e32699766b1e111040849122d2c0ff6600a349292a27022b3d1964bb5d8050362f3bf042641872e8d0dfb39c94bcf9068c190450ca4126efca8bbd926a8be65c9d07e4b2d19a226596a50fec795fc0b715a9cc324a13e15c76bdea9a0e4af8689dc95410638aa4b655f7bdac268284ef74c824d9626953ab202fa185715317f7621d602aae5e186d6b4820663c418d7374a2e8d378a306861ce1d775a4a8c5c06784abc084d45b001289b06bb39053e7777b6d691af5affb5548aa703715d41435a43e824beae0051ebf0189d1228f7e6065821925bef16de743a91b74396c39318611bc28484a7e96cf9066113ea27df045b09dfa89c880a08775cd209c6b6f543c742bd07e61e52b4aa41899a705646a790d2929db5e8610bdf75511f8b1a6d48cf3b691a0cf6a1ef6c92670b2c6dd97ad94077dc5408100244382b89bc452a17f5103aed6500a2a54bbd88e0ff08d9666270f0f3e015e11f6f34c177f7af4adfd04f8978f18a524cff48c70f1854f82f85049c1f9ed24155284dac43dae45fdb49aff52e9eb11af884044da9a312bc158142cc6e7aaad028e8260da39eab30483a7763cef83d73f12a98979f536a46deeda25b89383e963711349cc14e4defb2847bb0c61df705f465f0608dcebdf8bc1306d4910bfe438ef10b718fd0329f4f85cbceb37d853ff743a848b010b1e50b44edc47334600e664acebd48bd83cf8394be1c168c0cc4da41da83f13c6b879392fe035631cc038b8eda26c0ba07802480774ac013368b741634fd29784c38acb9fd5f17f84d62ae76579b392b97f200dcd73efaa7790a1943fb99d77589ab5c6598bf43bb9bd034179b01f869b5d430e4aec014f619edadb8fb8c1396f18f71b1feb200ee93a8ee70ef450e9f5bf9eb5d42987a4d34b698c9bf6f1c0de914fd3b896f523941a3929ea6e4654a33cbeb05babecdf0e5dfe003338caad556af72c9efa990ab802f8a3cdf15f05a6dd0c884eb58ce3d06958e57555a30fc8954edff727568c2a63b51dce9e03633211f7feb5b80ee4a595d6b10d97acb2dc0c5cc8a6153e2710d774ed50ebcf85556847969698a74c1b4a030774bb7edd355cca7d5de68c0a5b3c5f3fae02a92c0dfb052f7c9ffa970d9fb3bf79f088eddadeefbcfdaca8099cfaf3ed0a111efb962a5b893279ed5f624b36f887c6b244352dc946d112bed31a538022d27e1334d51bf4a4972e6fa5eec28094492bd5b5cb5a5665664f72d39337800dea153813f16518aaee105356aa9a401d8b65b4fbb951a71c33206bb9642f6d315d2cdd12287fbdc7ac7442ab75a2ae2506a0a6458377eb505acbcbdf4a5d8194ad44deb118baa21816609ee26b2df267796e22b3e531891a2596ecd696554c6d2110bf13f5241e2daa71a56fd124d4cb8b78c35d67722ac64d676b39bdad7490ce576a90c7682bfe161fe19fa95d742031777b4c80443f22f6d620f0256449555e72e5b382c43d739342adacdf6ce6501cd9b5b57a8a504aa4db64058ee0ca72f32b62900e74be6f855ebac216f54a6b9f1cd22cf03db900488b1dd5defc457fd06c670ad8ee9e7b5ad2a9c321b447d548ce00f8eaed63a8345de12eeb4525f21d8c5ef66bc3fde74a0bfb72369f49a92e6560a51c67ee4d1b1ce307daca36939cb35fad382a3ef6f4bd8315aa82e00467784740815cc89827926a7b06ed47c344a9e6c0077affe80dcc5c57ad12c53afc45064202011f94ac57e3073e901e168514a1fb5e35af3ce1fbd9aa04ee434d18bd784cdd9ad8fe2091790a70e39059a51a318e1dc0258663485df58f48b7474f348ccea202d4814c8c077497923667a84d2d5a809e6235486354bd36843f0f5c5cd915b4d0900482cf8912f595a064278eb83d3af361a8ff57cb1455e40142ff3ecb606154c8ab1eee031cef2144984bf9a6a0cdb751a9ccb8bcbc8c0ce2e2b339ece889a037a0e1745b22ec7b8779d18260357fb2f311e73234651bdb3fc651a8198d3310f815c9b2b02a55604436bf899863c84eb7f6d3a420323b92e4f3a3277c6a7ce4fccdc0f564981d14f44543682d93f6208ecd6188a119f95dd8507eeac3c6d058151e1a7f4f18a46a204f6453aaa0a2108089f4c7b12873a9ed9e262c54ff53df4df819b7929e5d528bc44af5b6f34b26d49bda7b4b849f08e09f1d5ae1338281e4717a0c7f150d419028c5a215811b3421644ecb5de2c1efd95d0bc74339a47a3c31e3ecfa873d9382f2f8cc4c566db19a0edb2ee36e6e7d8dc0aeae4f06cf30525c89fbfa844b6b7494d23fe3ad152f8e6da913e9960322d99267904fc8768106d40690c8a90dc01d8514ab1937c96edc16f0502fe81491b5c5c95f255d6e07722f5b39d376bd1c7a63339a5c6f6fccd6a0c6a6840723cac35da3b806c0924550461fb5fc93f30cee4d61cc167a256bd08d78c365299c53aecc8855e4c6ffffc33eb077427785b4b6a18368a238e496630a5c9ab16ff5aa4e84f86fd4d8f3fb13ca3903302f7adcfdcccc45ea945cb9636cb2d1bfe505c1270c0f747ac90024c3c958684c3c087bd54e762f6ea7466283d36cd879a5494dd382c37c61c418576a8635d784c8cdff9b399ea3b02347aab6fe5bc2ee96ab76199d81ff8e532feb7aa504567fd4470f0f8ec11d591ca15f53229c24a1a14bb4544f07a1f19f36af6617102a37836dbad9961e20f026d8e07001bdd09a3afee156ef68d92c938feb92f74656d5eef63783087989ee4f16ae7eaabab0714b5e272263c21ecd294eddad9671c7bd11ce44f23e5b0647fe64d1f3c734bb59a7dcf366df1a899018a2fa51a225a7112bd05fe3c2fb0e24eedb4922a92fb32a9361f9f65d67c765abd2c2a1ef25d4d615bcb9d773a21de944f083718f3cd0eede1826580433706816bb7bbd22fae3fde0b6eeabc8da690e8609034e973c99ca1b3f70f4a2b8f8343babbe1322c947752cdac45701b25c43e8cfde6d939801c2144dd326cec2890955992e5b0b9359390f14ac20801bce083302e3aaeec74371955a6cebb127223dcb3246b79f10a9e037f44c9610ae803f852100487e0f6a2fc52298b05dab2f3d742a43e61316d07de5851183560ecc79504f4747fdf6f64aaa48c97ed29e070a903da9e12176e125c6cbdc14150711a93569cb687477d3265ca281850e8b3dd39470eaf70fa5910785ae99aa3f3e6b90edbb7a03f634f59f1346f5668f1a329cabdc0ba2fc5258da0e761047b5e87a308ca6f48f38a806699efc3b8beb1e1b35e89b8ddfa53b8e466d0b3e82fac0ebdc78a86a6ac823b6f38b568dfaa1e3114b544bec784d13c43d33fa35c8580fac385477a39baaa0b79f68a9d38480b5b2ab5bf3cb19bc385fe973986070d6f3a7b2d764edff376d51dc4bc72bfaa17a09"
        )
        val state = Serialization.decrypt(TestConstants.Bob.nodeParams.nodePrivateKey, wait_for_funding_confirmed, TestConstants.Bob.nodeParams)
        assertTrue(state is WaitForFundingConfirmed)
        val wait_for_funding_locked = Hex.decode(
            "394227ce9e9a2d2cf9fc7b94d6d3f69df0a87f1472ac180fb9b56c72746763fa311169c07b484ad5968da95691cd3dc4ddc3e8a67c9d33ba0a263e6267c046cb0e19ca47e02cc39ef45c594acaaccfafcb2a7dd2e91b1d437c14ef992df3dcbcd30583938ca1706d1f8035003f95b2464e5305be4e73cfd87562b73cb75382f41b99ecbb5af39edde68d61bf935473a094a99b5b57692500ffa603a5ec049f63a4176ec7608e750e1d45c8224a6dcfc4fd134c9ec7861e7aa4dbc6edbeed919544080632f65bf57536d96d7c0e6750c0009842178b4ab97c166b443ee95d9fb2a604fddffcfc0cae338774ba4cd0573572542914440a0e80d1e79257e8c216db933b62d445abe2e56b6f56ea23f3629f5bf8ac3591d88947bb776a8672e13fc33cc53ba4805782169e9bd8c367cfa941bbca5621faf8f14e71f1b4550cd276350b70f8a94307efd3792cf07f0a4ff79ee7146dcc41910840720c37db66135edfc2f493a2a1133bc90e03ad0006c6c5feb797e7ccd8ba35a5af8b3a411c7994c6475a00662fe24e1c2720237f1a41ef45c1397c75d5703dacbc28a326643e240e1c0e688a761d650a27ba99ff2448bdf59cb379167ba07d8e099cbaa1419f75b9e4d705972cf62aeea9975acd73d65bd78c297cabd95a75604d46348c63ab7405fce17f154df98afef7b9aa7676ea46f2884a4ba1842514d1e3cf471db40053131451483d0d5d87e48694964859cc9a0611e531c4a6d44e76c5df2119b1a6689dfdf88faab0f4075baf7291531e53ffae41477e94517f013685e0aebae9d232dbfd91290c5f7a4de0a547e8e2ee9670cf6b21960c9c3bd429f133cf5c95a42fad0eb6c433816ff41b72452ffd580ff401fcfd7f3db13ece38d2f1c72bb4dffe6ffdebbffc65ee78d965a4946501727fa47404fe90334a52c6069d0174d907b7a79ee8ddd70be8a371f98b23e40ab7e90278a589c71a915e86b34ebd3709258749081e6cd676d5e5af520ca05297075cdfaed6cad55a00e036239350a6b1415a5ae385212d9444756948b178526e58a93769299e6f9277cf1d96c8e945151f93b38a5ed684669d0a6fc3ef01330f3883aeac1818ddcece8f1e5293effecfa5eda29e026a93163a0224a38636c01fb6bda4231134f551262dda0074774a61a64756f52e36765a1f4ba55e22c277d5a42fdb467244667897e97c832b0b710a338904c3391f1a9828431b3ff9c5cca2a8532c8409f36219093fc12d7051a7315148d3a46987bf0c93d3b4425abffc61e475b0189e88ad923d456eb8915c060ba18504db76e18c3cfb9195a96ec8d10550669528168190756eedbb0d5d49d6c2f59230a754fc27bbd34318b88b2e40378f3492b00243d6006a542d6062127074ba50293e3567701c1eb8d554886746cc21a203b2928d5405d60ba950fb1763a3725c5df73c7d201af3fa6e530574605b9e306703457ae1f41bacae3992c6e946eb2ce060ff057c2402051904ebc88e067ae221854055e0e7ed440cb414bffa23e03b66af1f695e8b429a3116e2a7191cb80582a5b1401cc1a4398590342c9e792b6b21997c28b4ba50a7402f7cc4eb84df6df5bde644c6b3b5b421687a2172144a280cc524b6e7ce4e502f6cd5623248c27435894e20f9a5f3eb8fb34a388c4e83b09167b16d66cf3537bd82baf01d53b43329387b2ad7fc43e3a0a85722f00ba480f041d499559782a5775512a1959317e1fefadaa235a31aeb3e65ef2ba7ad268b338efbb3e0cf47d9d45f7d1ea8cf41e474b17a7007a821239f176240a6a8147bbfb2e032e35a12c1d3e6b8361f2d492ca2c9097a1c079ccef51167d5962a4b1c1413a32e2a1a9fb00d7d9760c70f42a2832c98a83c69d211d47c1b66aeb68fa7055d239e9c34ba09056b33dea4df8a65b8b3ebd246e4d77d0f8d1dc5e090f7dab5e5e696ef9b3d8a5f627dbf311e0598fa89afd2e74c4ee3500e5c64c12f749d296e2a0fa73c7c6a4af5a529f7a572b4a3f173f58802d062500c67c44f6db44f9e11a38d6e986994979aef862b77096a23f5cc197a72586e0f3129c8cc92074cc4cd9fb4fd43673bf7eb544346866ff86fc62239c60ffc07f9930eaf5bc04b39f323224d13aeaeea78b2ba2ed5933880ffec7014a9b1802d3ca842f18e38c354c7851186a670d6ad34248b9d3128c1c7b038f426244cc01eaec9c2b2a6157757c3054a8f902d97d5f95c7b7a0594d0bdf8e8aa444201168391811b3ebd4d3b6a290c430ab00f63f685a11f8d9cd580e3ec71b63d5d5943bec74898b5204694e8ad183a21a0bc41e31bff9cd93c94d2aec16aaf8b28bac6f544b1fdc058318052ebfa923b8a644a020b3ce9706b17999c146125fed848c80d6a7d6c6a537312fca8b7c59a76ead2a108dca93755515b4ffc221ca2b70e665e37489ec5449f178c11a8e0b9799888946be1475bab24c7180567b4ca7696a5ee5ffde4b1cdfaaf0d23b2b29bc705cc1a6640d80f2847f06a930b26022c4b7c4543accdfa06b155a98262af01c70b757aa1723255deca1c2dd8e6319ece97e8c56071ef6437ba0f5a9746860133fd6f8d7f7c1dc704d36ee2e2dd187d5c5cfb0a9184e204859680b4b96b388ad9bcf8f3be4f289be7339079f0a1cd762cbcaa02e699adf4e841e1ad44b77ad4350c4d7d025af3b4fe835b686e6015d35cb6fe60b8870253fcccc387e26a648fab82f1bc2321c6407e3f1ae2b8057161678c0f0c9996108ae96f3c6d0795edce0ab691abdc11bd270d16632252c486194927f3e231870907769350052b3505dda1405308682ea5062db65aeedc1fb9ba50fcfbaca4b7cbda9ab6eb821e1180b3c747e7a9765e4a948e1bdd907794ea76d522f19a8b1388a1603ce41ff5c46e514e11bfc2f27daf35072971099422022af8f1d4e6b312a81f3330dacc2cf784baecd8512b30f37fc2c9b8ebf878b06b6ceec0e419f68006453a0f849cdf4a4afec06cec74245862c950c4f56b183d380d5e13857805103b376bb035360314385bf9626e68d7ff8e68bd5b6e72ca482e3965988d0e8ca932dfdc725a7e5b41b34c107fd9f2cb32968ed22b9e88b60d1d0719e7c56c193aa0a8f8eb919dbf6b20d095baa4feba29e6f5817a8ac2b29aa744021391efc3c461d9ca8806e43a99b65b5b0eb5cedad468bb97be871ab3eb32044430e7164944feb41d2bae03fc4558c76124d687bef90ecc7fb6e8bfa93df848a4ae8699fb13942e0f4869e84c05b00f347cbeb9ca4944616e1efc4e171a630dc11e45bfd7068e996fa1a573132f9bea9cba4953e26dca469d0f0e5e2895ddf37e0eba0599fe49dface166c3ed207da15b7854fa0500685fa99ff308894f7c47f84728cda0199456207c386608f52d33e77796bc3061adc4215a20b4284a41e77e51ffafb3545c06a887cd172d2abad60c243d3084c679322fdf03479018a6842e8d814510b5e9ffb80af2cb907be26c2b491356b682375b29282835cf238a7c6e2fe630300f7877e71ce3f3de99dcbeaa52f99e2c15a7dad33b2161fea2beca47fb00a1c619aad307318f2fb67248bff7fe13a5c342f182697e16f6b471b252dae9b36830eba884d4b5d3279b42adc35a1ad248b641f7d53f2475512f02b09115a21f62fcef7b56604fa76349a1ba4369c7392f498eaf8ff744d7f4b096218deec11e9d4007bf142994b47e6a7ce5add498de00e0c61863b2e4474d38969336765a8b478bd2b7be50577b992cc3e75120b9d564864faf24d1e702ed544ab629f149c94a3a42be5cc88e23acd9dbb8cc64993e1e5a8ffb2c4c44fc977628169564a052cd280ce649c5d528924e7912b9235e8f27c9f786da8e95cc34383c8d8975327c23c22530829cbaf8e33f31e969421b32af4664060396372d7b44bd67a5b38cb49ba79f4e8408e2cb7ccfeb56c8b5692d7839f079f82a409b614699b1eb143056a4af355f6840f0d81d826fabebab3112399ac741af439a8cba1afb9051b95b740cb2911f7304d758acb708c3631e81aac49528a9c781ffedeb7ad23a26316204be2427d0fd12b3d2a9d826b8f3c84ccf72f28e8bfd4f4799dedde2810961d62c2ba4b47988596da8c2c56e4c971875e663c0ec5e68c7e23b9abbdecf67655c023a76f4af34ed095a6956a6dc83504372a74324e5c224916aa0ee73d4514ba81231258e9f24c1a44e5f2e1cee021a1674d1516ddfc48092819ec4c2acdd0abd437adb21d8979d53faec974988190c8ed933d118558a73dbdb8f9b9131eb6a40d7af"
        )
        val state1 = Serialization.decrypt(TestConstants.Bob.nodeParams.nodePrivateKey, wait_for_funding_locked, TestConstants.Bob.nodeParams)
        assertTrue(state1 is WaitForFundingLocked)
        val normal = Hex.decode(
            "c207f3309e3ec64ccd7d576521d7d0e65dc36292be30d7b84e557bfccdd8102480cbb97b1f9bfbe267ac1b09b8b6829d9153cc5f132bb951f8bfc3cc417faa9ecd6ad3491f65816571dd304d1d5851685ec689724cd8b57f6cdc8451641b85304cdddcdd080095ec5cebe0e1a2c64d8eddc84eed08af8d423e92229a9fcb00860a0c691ff526f7909ab1b8ce351efd7a206322b7177ef9fe064215d0f8d13fd2ce474893c6f8547ed45cc69f03943f328a81169b18fdbdf82f5fd7b1c1af5c1227ea231828fb6ed0467af0acbd8dcc57f0880aae72597f920330d5571b1e7f7641f7f64a7f534dd8c6099e5a5361ba35fdf8f472407dce5867f9ee75ad89ccead717ced8525a1db14c529612fcabceab951bb5a6e38421fe1bb7c092358105ed2ecf7293ad0f0cde3873dad70a6668e44a6563e059b3fc08e07e3265c0bc708ca75ba7a9c238a14a8eb125581e998fa8c489b8dfd720dacd5cc8de832fc0065b9aafa2761672a4ecbb69f24df95e5fe892b01623ce0093f816577a832c9482308bc9668ebf91a89739efc3c965f34dce28674ea45fd841e73c3ca1eee01b1cd0a7e30a0a65c8517a8192e0b582aaaf7a3c0fae8776b38aad7e38ce4e680c44563ce3c635ceaf3b0295e4ff113208da349df01ee5bffb6e357c11b09fc7471ea204f1efbb214f1640029abe7aaf7c97215728ad66dc1d6f7b339f935a6a2e1f9f1e5070acedcbc7a3f8a7289d6265664b21c013be3aada176cfec2dc51c5b7fc7c9e008a837d3ad48c7f4db82d29462646484b1173017cdb81b2bd274ec565b67276f53eca3a0980af205759c39e8605f1a171e34b38833f84f3c0d29d6467c6df1f1dfb8871aa91277153220c82bef0a70d10fe58a1b94ec011d5404f4423b25e471d0df9194dc6df5758b2ee41411ebc9e4b911f6803cf32356abc8181644608ca55233785ac60966b80e567533f849f76876a99bfbfa40f62b6169f6518badc1aab7b531b223f9282a723e6426ed310ea8e91c0a342dca9a160955577ce97e0447954000ef048cdcb0105b1a111409dd8a818c36cf2fd4cd8d32065ef8b6b8bc4270677c40bbac05a4becbdb1c1a5f88a845f2cdf1e39f71d5e668cbf44238dd6bd917112c1e963421c89ae84ae780acdeefa77131dfa4586811ed6f0cf88cc78974dca3d8b2cbc0f7d3d2266c5756b1faaa16587367d0e0a710db90b5318537601ba713e5d06ce5a631ae5e31b6744fb5ec39d7cdf65c5c2f265895b37f079acd6ed4ff0a9ea780899bf44bab32215c2440ba1e0c30089a5fc49abd3c8c3c847190be76d7f01a1d6b1e611823c58ea168926edf8511201183db5c7038b0d1d9c6aa3fe6eaf7c94f08e2119612e4e10cc92493c54d35e794c119619baef4e5492995f5e3c8f5ca002382def7f4ffb5a27ff8930969cb528fcd1713a9166ccbc6e105568c495148f5e35a64fa81d394d73ff08f7ea3ee21be2f828ec0151d6a6a9dcc34a9664677260635c675ff182974e072c67967cd08a019aa4d595467b77198adc9f43e1010a5d5382c99731b05a98e4fe600e57be72d29693196acd5c92641160cdffb4cc4bec84c1e57c9bcb3581ab98f1c3c2b2f30d79813c46b29aac84a78d66b37f2ccb63db5e650b87218401be534b54295f6772fd6ae74541326fb3c27a1d386b9dd9775b24996f7730387ab409ae65acc14d7bac0c236290e9531a833b0519f96a0f1149a4468e6020978f5a70531c73d8b15f043147302886a20334a57c181c34e386ed16fb69a27aaa791aadb3ffbe6b6cd0a86c33ace842fbb1009754b3f5ec33242ad0624679717eeef8422e6f520d320f0fa7e3f5cdf0414aa0f9670b0643bb38cec3c7050fad6bcb394e30e7b23d6e49a9a9978c9703c8a14f9bc8ed592c07e73b64992fe2b255ba5bd07581dc819b2b271aed6e15c90f003405b51ca45df390ddfb2824284a8f245f450f773af6455c9effda695a5281389da73f10d101cca7e484e6a0dd206c2206c6952acad6e593513f5cc085e546792285d26b6d21aaa8a516edf6d2e851e40a0815652e2ebf293f82cc796c15629fc53c706b46e8f591b10f360294e5f10430fa575dd4aab6893df157a75cf2cf05fffa20dd264701ecfbc34affe72e9594e55cbebf19f03c0ad3873b8c284bdfeb95f1c8f97e2a0df976a38a599c8c56110b215f5e3c8bf1aa854e06b0b1ac34bdd9d7c0cdd6f27b79e4b09613fdf20b50d4a4ff9de27bdcb559d184220a0f0415dafec69f7ff96df6d358433f7b6f8fe5748d51a6ecec3f90d2a316ec38f4a3a0abe39464b7a321e5395cee63eeecbaf2d88432b7df923dc88ff36a41bf374b49d791d2d659b94ed236e899886900aee1c93413705c03dc631909411839d6b1b9ccdfe9bfccb95bf67d421234ac702c247a340b103c5b16d7e4b13f17c25bfa747cade204743c7f3736016247f1d412a3f5d7efe4a0e2004f19334bf7b9b0489481cdb593a2cb482e0027022a795abb21afb1656f5a09083f40f2786d7e1ba53b3295b05f8b96790960fc348de406e604e5c0665aad131cd4e930bf2ed0fef354fd4971d62a9f3ac795c9d36c01e2e0bcb5db96bc946710909443e0630e39d9d268bb8d6d75325162cf0b3929de466194c3b054440ac54e1c2ab28b0b4711c418547ed5500e6981117f412316083e892a841d8a01550bac490d149ccefbcd4cad9ae5aa9205edb317f618b06acc59501ead750618994c793bea0423ae8e3513316282d3722baa1041509b0368c3230bb7e10ad9f19594374664ffa321a3439843a12d69fc84f206bb0711c67d5fcb7790f43b78917226c1db29423e05074a9ef178a720c649010475ec17b121864f0f615e9757d51c69ca8ff9a48e8fc54916182642c456d2c12fa4d94e1f4a6e916b32e342f9b3a7179225c517701bd917c6de4cdc3b8c7bda7a977bc34162f11c00ae0895b3331cf542fe3c689a9a235accfb4a28f18d822506c6c6352697eec7d7732b5818a3783b59427f75653469018736c3dd03eefdd565b83a878013bae85b5ebc40ef080d39935081b3ebbc629097cf1a141c9c0f64b08a3f196ae8ec4b6fc73757e17ca47f40d10a309f936e02598cc305facc421ad7545cb2f4341cacd42ffc28e5cb51e3b03e6f2f530339caea268fa415845477fff3c84166d7fb26a975fafe88180fe723527beaa633f2fb268f85f87fbd912d79fe539639ff6d3702f1fa08f6e03975a357b33a999a5c6186162c108efb32f16007c10664474d10afa814a9ceb593b5a2a6b1c37fc499584c984cc7f78cd80c1ee7959280784bcb85d902d5b96896ebeb6b14851be00c347cf863791f7454604e8a58c9509a56b82721ddd80144bedcf3053e091caa0b574d8414a8946ab326624a8914a5c7b36e002780e616b6066417d0c9e6d0de5825d760253ac938ab3aa2dfb73cf41d942cdc7c808bd400bfb0716f15bf8e8953850548b4b8d1c2cf4621d324e7207cbefb3f192062e79216fc8d71820e083bcc9285c51f94141b78fbc1aadced9c61f7fb9b7789fd17dd664d28e4b73b4d295d5dffd34636de62e7d449e046a66539da5a7ce71d38d757cd185e873f375bf5c34baaf78cfada8f8855040f82730fdc567c08767706515f4720eab0e5659ce49fb85ca40b0cd111e00ee27c6ea2592d0da518fb28010ce9fb36e3c1f02e4eab361aa9955193b00c846a891553e48559e03d93aae894bcb15db586b36f2914a3fc841b32e80e33d873254b6a18107f4385bf359a1ed6a649e2b4ef7b11af60af4fd1626c11324032ce71fe707b3e6b0ea320e6540f294acc36c0e77366f6f1f16f4683f9c73da6ae77d6dc36a34ed5c23e5d5e59a82b0cd2099510cfad3fd6be627a26d11f8d3a88e1f49f74fef089eed30d07123343229219f55c5bb15a5651fb95304282eb0757506de37cc95cad16449723a9bb7d9a8a087bdcfc15665c7b2787ab1478255ddc530cf327c22f2ef6e404c116045eaeb8be9a137e754c951a1fadb3829283107eed807e1ce7eea848600f4e35cb37ed21c11b3c6977b05d6a9575d17a5baeace3b036eb87f2fab175b6e3eb1ae6b22acb454162d257737e59a38e346abafba9ce1530f5a4a900fc6f7048f0aace10030c638fc205a1309e792dc37639f69f5d569a1d1b2c5bdd4d45112bdce3041b9a117a82585522854857dfc686bd3f6f4149dc0294e7ef93c21e9f006c1b9994388634d338c8aa4b10c7e2017a131bcf4a9f1f5a44e09b136b5df5f3b80cc2b4101859776e6f71d9e5a57e88d623d042fda6e8512c582479e12116993a6357908eee94e26e103ff2efb102b5a52ceddc323136ec21b2d87b743fc4ab8339cdcdbc717fe77641291f9934cb86ebf227f1214ad5072"
        )
        val state2 = Serialization.decrypt(TestConstants.Bob.nodeParams.nodePrivateKey, normal, TestConstants.Bob.nodeParams)
        assertTrue(state2 is Normal)
        val normal_with_htlcs = Hex.decode(
            "9300cf64e81d29328c082f3b98a58b3e156ff01126416bd5a64d4722e4b67db83b692546b8f2d1801e2b2c3ccdb48e91029b424bafefbc7a97dd069cf8a287ab2ecd1a18a5dccb8fc1012fde3d3d65eebae83292d646405b4e696533fcaeab0f689a1a15de7aeab322f0c0e87a503bfae2165a514e9bb956217f12504e16297e1850038dbd4898c14e3da34bb6cbe01ab5aa73759234498ccfba5bc08438d5f8788c69bc1526731fb63949a020d3a8bdd50010369e4ff6b2177ee8793e35474b94ec647502fe5b3ca4e452e27d425a413e06d0ed63a908ec4e992601b5af34778d65d84162cb2d26f8793f47154e514eb6c5ba9e8b97712cf254185161ddba8d360d87ca469a32e6f20d5d91fb75229616156dfdbd955b92a28b288884f99ce0685310e8341b714173f0ec83d87de9502bf75d98ab298f400386c2b1804826794cd68859b2cde5fefb020e8d8117b2789b6f1d95f849c2dcd7dcf097207ae25ec65625bbe5a7465983a5a2197341c5e2542cf29576c9421c163bb69cd8f0f1be6246f96e62cbcb2398870469872ba1c1b10f2533c8321453ed2dee3b62dedccac47cf631568091add2f6408b138662a55ba9140b82d23759990884730ab6b9742c56b8b272944ab4365b8a9fdd67a6e6c3b86fe80c67a4b5e253b302695fb6163cdb1a4b118f16869ce40087cc3590faa07cd6d3c534fd5c91ae89ba1ed627ba0cba45c3a3ca9b49bb6d0fe7d57019a2504c601aacb5bb7deaf4149a6dbf1153da00f174d42f247c6e62b4d448f028900fd6f11fd308e402f5f71593c50320edab2e8e4e3569f6be00947bedb229f2e6cc0e34ffff19a3248f3e9d71b0a3f78d81d7bc6e1ce97cb7f127b65c7d08b5e7b15e9d44f28f590ad9e29e24a2d973e6fc79f2abd86d6915e7d37393c5e280e8fe1854639105bcbeef5c9ece791caa1423e6c66cc351ed4ae5f47d326e537910d786bf738529ab2b9a658b6f3d490103f4082e6021aed15b29f65cefefe0daf7e4f00a321d8d2bda5e3ff142e059b027da3f9c9bfaac311ea0c577a577a9d257adef445c966e301145dd57794aaedcdb1081c89ee86b65de8a515afc6b2514e64575919692ae764440d3e723fe1aeff40206dbd85d46cfe2aae6a9229f08f04bca768b7cdfa5d118cdf6de5c66d44d5d98e73cf593e029ded9b87ad381ab0ce0eab54ad98cf52160b75488943c9ff4e73778cbd60435dfcb4489c8c9081f9ebd650367a8f30eafa036a2357fce1f903eef0172f7ae42d7277e16ed1c095513955316167cd69f3f49dbeb022dffd8f5df8b44d9f78cbc47276a7de62d550854b2832a99b4a42a8ab709dadbe8a5c595105eb90895ae8e3daee024a28f12b4f98ee62f41687b486bd99211d478fe4780a301f79205c87e6ae0c7569721f517ca0fa0eab19727ed01a6ae12f1ae940ba86c4da24cb07aca3f3abe6d9146735b5fb45aaae34f9720ccf3d623635e9abd3408aa40ebdc3305df8624b947811a98e7ee11a3cc2294fd0e9506ecfdc936309cfb0c08b673aaaf139f2458d42b8d8895b72c697cd81462eb246122872b89a241993306fac6953da58965b290b65c47ba9a76c16aa80fbe05c49c410908a899cb0382977926f51e6e95b062e6edea331d8a946ce4ece90564c687e0cce1b64baaef7b8f874493a9437a50a0f333582472634ccd05fa577c6a0f4ad27589ce7ed5ea9dfad20381c2211a1da8b6da908e38a26191d216e9d060b7a288f4f695135678fa48a29b05672fc2d20eb211a4c7f71d7c07299c9262d21cde189390871a7d8cbbd0c170680c841a3640cd5a9c3ec1f63ee0bbb63a217aa980350f8ab052d5b4d9e6713ba353bded4c9f845150ef95165cc85973629e93fbe51b6b206996433e746fd5661dbd2b2a9cded9ce8ebd6703d2274c861a6123e130758832293f361962344ac2e892ec90a759b1ab15da2c768441b10fa68c10695dface2235ac3d498044f8d138d8b1a995195d71af31b4fadbf7899b2fb5f69f60df52139a76b27b61140d4eca6486a751c1b58c928a2126b91811b2818f5153c92d37aa998f2587d794e19adf4acb401b6e167de0e04c5798e566f70aeb92e1e5245fd534639188f345168d0be0606bab59a26bdb0565fcf5b5e95a4f2e08e0279b06888673e3cd851b86cc4eeb20e86e4d349ac6dfdfdffd9f3b045ef4699985f2c3d331133949c084f5e3cc7ada6c23ecd33ca20a6792833974997f5a8276a9240bf10285b8526b15aaa2e42345d7c10c5a947121b95356e6355840dca6d0373b41eae0c50e51c0436970449964a855f9d224173f961280e27db6a2d15ce63aee3d937a502f068ba31df25d45c6b100fb4d05a5d6b0a169b6abdbaa932d0134783af8cbf18180fde2f71ca5ecd4a02c752322eb564b65293c88283c706f01eb4660fe6bb7434b5d1ca1a153ccf03a57b9ee3e9bf4176af312723a5da58e5a265bad34c444c1d9eff74ec262977043e31d4aec08134dd788627903dbe08121089777be236ec4944310796b996abcb698f3fe271289482a0f1bb4c3a4684c6611f57d0d8fe86a1d362097184fffe7c5115f1b9a6762a3604bcef0ed98a8d7d93d5d9e2eefe9130c5eefda67f91208d26af61757950341c89bd612111c1fbf00bea19a5951a61023864ab7737c9b54062e0e03afb2d21333151bfdb9b241e4fff7f01465f5320e928a91313b4aebad1d8c062730eaa3bb921491fde2e3ca14b9365c42a96d679100d074d67fcae0cbef56af06dfa4525f6778cb3f182bbd355475fd505931d6e793a08825d93d9431bf3a2f4cc93aac5d12cef343071c92ba6cffcb22b682ecc69e0c227037a0d731e787f9d86db843cd8d410765411264c7098cff84751a5702d4ba181a86a5dc03b2d2866c48edee6ce2e87d8c2716f2f67a1418d12f50903f2a183f5f85eaef6da52bdecf3952ef82cf57d3e70158beaa0c2ca9a3932354f34cc8a1b85de7028cf05127e3ccde73b716875b2670f18d07a491a786732f3638b9a5225a7056b1944ab5b0d57a98e68b25a9bd76e13d0483f8bfe85d29740b74c3d7ee81716fc92798223df1333d728343ec572f405bf8b5a9dbcc823712114609c70ac2b22fba0ccd0f2eb86ab1d0a3f1ff6fd2c9678c09ce508fc481e8f70f5e9dee0482ba942397bccea74be1298c9ce855d9bfa0b2262e94a3256414e0c3b4f4de4d313d557c5b90312da459570aeac680d9a2f66a584bc190318654272b3526bc2d6d8957e70812855ab79509ea9d9651822490e58dc955946a256d01bf570f200de1936d7052e65b2389c4e2f1248202a0ef9a4fb3c5d208944b80240e42af270daf3a0f22b6d7d30aadc526f3b99206d4b7221625c6d4cc7e5631d2632dae992ec228b331c0e5c4c32c0ceb1f1ad26c34193ca1d3cce34fdbf32ce475b7eeca64e1d26a3631868fcfdded27cd4e6d2cec404d2a27236308664702e512cb7a7b6693bf9d43718b509b063a33171cc6e9a30fb341e39e4190e5f84f9fbf429ee938348dc15dd0e876a8dab35a938aade07ecc91ad0e28dfa06866e6e3f4202fcbc497232661251503d6cdc318ffc45f968cbb7e5e39035a2334b4a09cb7fb5b895fd44a4626c2f9cb7bee2154e9d4b97dd839b5a1eef2f0bb516df840331ac3b7b2d01eb7c0558e81fd48203f0896be1d776e1bf43631825082d3fd663258ad9b252022ddace0da71aef2a88e7ab9d3b87ba842f27a9c151838524180fde5c823a6a2a6234c90a9e0b5f9becb7f778d25ca9e444ea7af121c2b64530ec3e04650448e455a6c4df4d5d355099e3b0110aae59e422836e35a1b49ce206e6b0f4cce52303b84ebb8eeda742a8abd077bdc918042ba36cd5e78b30799029fc218af89a76e5fe92ac4afc7ca4f3dd52324f5bf5e21d6976a14c91ec9ae47a1c32760a5dcb7551c3bac653fdabf9a74c65ac6c2379603ca79e599a23ac88f1621965a343b310fa72e73f742a736e08ca4ca31a45bc4da026e3039a5e3ad1d43d87ba4a61da9ad373902dd823283d0224dd24065d240c14790987e247b27acc6ad4f601e0e7c4ed42325cf46052ea852d05fcef605335569a7994d3744d69e9e83402172cd040d457d55a9e72f95333bd8be0226b5e8c4dbcba64359ef2499e34ca2778acb3abec1d2071373f667f6d061c2b11a5c7958385309e9d3e8ecd586e3b78135a0ff3c15f69ea05b5853bede01211c1a428bcccc9ca7ec1768a02ee356c768323f21657a94a477ec7e4fae97b3cf8be54b28f8fc00dfe8bb8ea679e826d63f105c554723502d5c8ff8b9e5dbd885253d0fcd27a83dca721571ebb2aa63010fec634731728421f982c71adf8fa5df9286ae97fa8fa927a7fbd1f9efcbb77e37c8f4761e02db0370844ed521f95ab859987f8d4fc1d762d0914449d62ed0ae5f44f856004f0718c0b4171b6d09d74a76f97f26aa233f78c99949979fc0c4ad7ead223af590ab6cfb46cb15e46303b4139de7837f709bae68e8180d1e1ac151f575e56ac9ce619cebbfaf76d0c83708e41f1038b0134571cfb7673d4b6b2f6cdc053891f64b33ef9d604caacfeca17e6eb73ea96ea66f32cd85972db179401504b8df11d58281c5cf0ceb6e96644ce608ce4f5eba41d74431847d7f2da1f8a17c805788e726b65357d2db94363ec90f245029c423043deb36194e23679cc1da75714e5196aae121c48c7c176529399faeb6bff617297fee33c287d08f530a489a4eb97cebd47eb5448df69bc423f805e56b759fa4a27d8f161d457fe5e3adc662da391352fb3f567686d84b0d366e3ea506bead1cee37e2a4abba61e52243d975e3e5d9d685a5a08134614cd34a0d0930857e8146c240b4ef81083a0be988f66f81056272742e9326552fddf22e625a2497449e0fd89cfc3bcfb34168d8ff30cb03d732f0f0e29c7af0c5c35c87abffd5e8d4375574a7b9c70169ffae3a65ab40e4726aa3ba2626f3bb946bb051dd25757b5266c5ba92244023b64ccefaac806d59343efad15b3acdbb0db21e7fd1f9d0dd245529624256ef79f032982fd3f1841ecda72dced45768a4b95a28f1c9165c009336a32557c42109804694c309fcf1efa48850bbc62a098c1a1720ef5b69862d53c70fe4ba2e86aedbc1a291673c8c7375106fbd690dc44cc945d3346d0e1fa7e97cce996644e112d634bf0435310347d58cbe178f694e4c252ac16a623fb1f87060f17ffc2d0392e10ef157242a7eb082ad51dfcba72ffbad367e9b65da904d7d8dd2b2bd01cc71706842b8e2ab47d9fd592251ff986c87a5e92c1a666689e47cc756e9af10bf51eaf2a6bb1f3414000429320fbce800405b3a552d0fcbbd88ee280a3441115eb890a9b922bf004527856b32a735f5a3596a1f31cb127c00d3961e9ef0de7ea81b30aa1ce0d80b1475a24e4edb9cc6c2faf3836ff8e7f9e297e293822156c1866ee49fa76d33a984d93c642f7990b05aa46a651b6138a71f04f3761c97ee4b09cf8b34d26cb76a88397400eef52cdc12a5e2d57565d858db2124b81f556ddf83cecb3e053698b524bd391fcea0bc1cb5f97cd8d4d5a4100df9c2a9d2890d854cc7deee1523cfd43b2b34332137fa2ae8b57cc582a61587c3aa5c361726356db8922df56ec6333ddcd14476869edf76e23f327f55703762539ccaf99a72301675902bc0b23b46939b08054909455225b316a089ab25fec7c47d218c8e1d97fa009d71078254ee84ff688596d3d9ca44e7d153a1e77860047887b9c650f94cfef73907907b30460c175feb57dc872c1703596b9cae41fd24bff1c981ba5b0cf6d4ccd16e291764fdc38111cf8c77d1957cf6d90e97327644c798ad6da48ce93923293c99da477cc8f3249ebbdaba6640149a85961e7cd47ae77fe5a39338ace479f48f11e5b0affc32fb2870d76d41c99909111ad04bbda0127a12aeb7e6c319b95fe8cf0d7d21651f0c7b2191abd87a6ebb3324cbfc20c9771a27435167c53487657b0490d21bbdfb1eff1ba22cfdae62d4e4ac8ee1ca704fc1b3d61999601314b50eee4ea9f476b248bb7598862339d6b9dc328f79ea9c0f17ac5c885dc6fa529fcc61147ab2a04c9bfe9314baf4c63553a3f1f2bd125194c22c33bb91b382bb71e2e85a554a7c652c0aff788958b4a757507c3c07d30e8313ed5329dbf750673563bcaa88bd0e477bf9ce9d455ed687b9a1897cf325b90eddc733dfac1e28e0157ff6a0c323373e27e897417daf037aa14c00e51075091f566d5daf51b17080a8ebf0b7a5a15ecad308c4e97783fd6f59fe6f249553f223c208e55f2143bfdc2435347b36be1df9a9686608e373d26a07a0ddebcd49d8bca97a5daa377635304796174904f7154b25bbaf55663d58e03d965f7c9385132c1782fe5e6bd9b15eb2f09f9b130842577c5087fec5fae4b1f9061ce5d73210fc9c2b509bb0e309bedded725c247e7f25681ba2f487862b2e9b599f26e7d4d2e960451a8e023e46590368f4ee9b0fe9c7cb8929f483dbb15ea074487ff85241d2916b6c19e524c000b6585b05d588eca277489fdd0a24f3f95aed52d40d49913cada7f3297a35be8a5ff8294450a5e14b6a8ff82d40a473b719f118df5663a8eb53398e673a1bb7b3e061d68902b8442a495983023719f243279d9bdb3742a4fb66079840f73cfff42f1cacdfc3a80dc9f0d85d79acc338105293b7b69f942cff96b9633ef42586c61793d57379df777c39431e5f3ffee9b9621eaa2e54e0d4c496b3ade33482576b38e1b46f43ac41232b03ece0368d4e13807e4f130db7d4ab41d43dfda1fef57d3849f20595430cad32ceb875c3093e1a0b32a1a2b0699ac4201f8dab12309bfafdb4db01cf7542f959331a4da2cfba941c0c0d3fcccf774d0bf517bb3b94962c4b0342d3e0483b538b30bb5aa3aebb63fa11be3ea5e660e6aa38b44812e6801411b842fa6d3cc11abb47f5c95d1662e71d07dc6af6a89bdda86da188fc10dee7350efad5bbbdc97b035b955691b10a69db0d3ecf91ed844ca2e424c134487adda3fbf528616baec224a7d068fb02b1f9c93c0d914bb3cf3c52d2393464fe7d9f2ed5bdf2d582bfa7ad709db053ee3699d6b78c05b02d77e14353c642143aaea1a6ebc113cb72b300910496402ee87fe8565c80b9d82aabf5b4707527e40ec9775412060c04d7462c11c60fd03be80a999ec89d3c2d6aa3cdc410cf981e3cc48ade471bd28da5b8532c4b780c02b244019785c9580a87dd0b8d1c443e34d0dd454ab82267542cdb37421ea272565b9711e4ceef6aab8c8e5f75c4a5f0aa4c9072a66e34367cbc28ea29629b936584e5f6a805e42fc7437040302aaf98ee232413752dd6612995685e92b6b4d909cfb8f84155cd52d31d60c471a86b910c765426cdeffc8feaae147482dc831d3d8b75d98595b22268ddcaa5a3b6be75ab435ffab2ee866d622e9fcb0518eb5b76b95c9b30ff3f4fd7682a5a2ff4137652748f66825f030c8afe5a552cc58d08194a9eebf047cad68ab5a3d5d3a73af0a578ad6f3e6fa2b63c5e67543db0106691747b8c60a970efdaf3175fc13142dcfc3806380482bbc2600aefe1c47eaca8a4f99020f1682e56b204270d1b94b9dfce0eea858be60853835a6c4b19124bffaab9f1a22e1f8c16041ae612902b7be92750426d258a9f478a2cc4037783ea6128ec46f99d76431e3fd6c4957638c0628d4d455f66d8517696951b01a6a27b3c92fe01809108089b42b738baae28bab71aa7e6fed0ca8f465d269d9133c35f85f4578171ceaf0a1962ec852366d2a6c66627ed14170b5f3673233e68d7b03f9945eb8258e4ad6147929101a18a11ddc0c8884a043558a15fd7dfcd8a9375595193886d734c88358df2e0abb4998185b673ee8c6e639b534a6b233295f535efe67438451a32ad2309713f98102200dc86c850515a2c11c332811468b4a8e4ca4cfe0c0598270211fbea442ea0226d7a94ac1993afa438d7f3e04b373a73ed598e076171c8efb8b012c29843795c32723eb46172a8db3e447d38578b2f53b16ae7ced0ba74e0e3bba5e3e24aa154ecd0638da5b32f42b69325d1ce98a3e6c1af8d8053d1b00938a1a9f776c73a63bce40c3deaa6e6a3dabcb52044c57ec9fc4eb2f0c8e0c53b19a85863a83ebfaf17bb35474e9cfe860c49774753f0350f168a7f7407271a010ac930151e63eafbbf1543de37ea0df5ccb2863188a3fd01701dceba46d165ad4476e30acc8e7cf5e0457b2a6b201cc7b9454cdf33e68de422c104adc97f38cd44e756a4fd9711fd475aba536cdc0c5edf14b20f276f9a420910a7a1b7b6f851e8186a56c96e35f8f65ab7ee89baa42fdc4b97a7f8182ebc253667859694c1341f28c19027f552a224fc167eadae1dd376537d6e8847d209a675c9d51380d0fcad50e3054821e6fa62b65d8735ea5a465383528b7d1e67796ffd689a8e8b0298d5b3607c1ae27332a8a2ba2573bffe4600090a5cc740d68d6e8265e3c5d971e6f2acaab5a9bb79bb2f9093bbdfc92b3db9773fc142397e8e3cbcf21f383eece25e93cd8049eeed7ad945704b505a62179053fbad5d6e7a27693409d79b50da49e4a2c6aadf198d8af6b42772642daa8b9288f9af589d9ceafa61544862d96bb8f2059cdf7322b83a203c9506954b9771c38656a6fea8d93c9ca4612247df9511ca6d82ba6b8242e783106c26943e411763acad19b75a24c1bfd47388b73153c9a6903a48db00b67d134eea0196d860480318e06ba5e9a73f9efbd731732f8c85580b54eb2c97f130c19defeea37e224be09f61b2ec2d7760d77566f4b15a2c8a51ab0827b702e6a28f981b0d184b14b092b13261ea53aa225365df4e84a4098f0d00204b6c0e27f1e024306c0437878ccf5ae7810ac0326ab3134b4f8c7f471ccb4a49d565532c49b3e9a5c57a0b103240aac6bc26c3bb46de8fc7b621321c5480ac133d02cffbc95d65a9845220a5d2c54676ba01c79808da1b93986fbe944cf6ce01502f980f0d2297a977faf17c00989ffb39c550ebf8b3bb69a4b7ea0a3342d2ab3ee59147604a58a735ce57a867e8ccde55a09fbd1c1172442848264486bc359988fabd9285403e76a5eca2870edba993d6c9aea3107eb905e3e0a2bdb6bbc60fcd01788cc62a3c851365df274b8a3b543352f21af2b6d8bc473be423f7b414da42bb97f5c48f5a4881caa8d01c08d9c5d8236c91387e70c2379317b6f0971070ef026a36b5109c3bfaf37407ca253d87eac326f8970a8f8238972e0c9144c9c6c7808a24728f9627753d34c28455720a78f82a2b44b94422c5b17b2281878ef4ce6b5167ff06c79ad5d4c991b4bd34ad3e4fa6a5410305b4f15e28fb08ae8de542e8dcc4cdcf15521d065de83b5baea42503ff38ec3ba78dbacb29a04234b488f94bd3d37d49d89068a41bec52cdb42713a17429619a72744d38708d68172ef72f633fd4adb95a08e6f60bc7d225ecdc77e85289c767618eb8319dca4ec671a10e02df450a1535fa85055bb3aaf7da0959339ce1ac7b9444a4fdf1b6515146cd056d692de6ce0fef56b2e057cf3b414299af657c3bebe2f6d8b9507960b3dd866ee990d680c58a3cf48cff83fcb39ff4167aa606225e183d7ec967698e6718273c9be67596aa2f2a5ead45b877c0f8869cfcc976a2380125f7d0a0d239258278161f72ece7276da44ad42edc5e276afb7f3c06c2b9ac9a38e4a941a73678e7443e917095cae48685d81998f02df2ed8ac3a7212988ffbabfc4eba0c73c1063fb0f91be73b2b390031a6357d2a6146d56ac56c7e72dc226792e5fdf96a973db5aa1b4f76b4e53d2e407ca5d05bc0fa05d0d997c3aa05998cbef0d9558aca05eb0b6d011261d577d964478f4cfdf822b21b5d6dd6f7027cade680067e1c2933c510aea0146bd960433ce3f133a60c1a4147802460e008439f0344147244a34dd1a5ba1971e45ef4a7d3adfa4b49a9eee25502a7b428e49128e3cf9b8e52c19ca1218803dbc090629425909525a4f5c24bcd84f32f8216a72eee7065a6d5c1f50fdc06abb1d24fabeddd5e9087b931913ed13c2e689585e2aec022e6f92abf65d3b9dad5cbcc6d3173177dc6c46abfc9f135b28c11bf23807f4a3dd993ea8332b4d7774bf13253bf8ea9823b9037a8b858d99c17ed7a2665f1daddfa541b93278b34e4ffa14c875ac5a2d9a2e1800942f18b9006723dd971f3321bdc399761eb4e3e85ea36d950cebdff441553829a8d8de9db960d87d386f86a720d4ec897723662c173794255bee06ff176b27ebb2fb4b8aaec08f1f5636887cd54762b2446fb0752a1c996b5c8f14302e090b2b2591dfdad9d36e7fd93982f9004373ceedf19e95b3786761acc84b9710b352a535338e3b75447b22c0874137415e7b62ca21ad36df1ef388c27ab4dac2237a6830a85afe1ba4b679bb43ded918c54f4e2d19ddcacb977a5b1294f242306377547c021882b891492d680f4fdcb76432d64344e1ada4e718f9f1d9104192ee2a5b9344ce31b40cca8aeb2db5774617ee67d21ad549eb10e2e2b4a825d4f929418d660cc805be6a274384d2c903e5befba1fae82ff0a8da2ea2e0c74c948f67457e68c4468ce01d1dd348c9ed47a51ad3a70b9905ba0cea4b47d9f01924cad931e504f24291d9afd3a75b3a333fcb99fb965db06e03bbbe7fcf14020a025af7cf9ccfaeda8dc29a61fc6822f14ec1c4dbf6562b3843e3b96a95d1c65651282baaadda200a081e33b06ad5ef7508134c7c7b74b0814ef54a7c510a712e1685dd86ead0b7dfd46ae442918a5519156dd546b805d42b799b23daf585291f41e146a547101f87e1d981487875f38b11f1362a520bee82e69722638e618fbbc23cd0dd037c6cab1443a4f004ea59d2b6ffa8c825e6bb553cc03bfdd4631b17d660d827a99526bf0309da141b04f465606c7fcb033b84cff03c3b7d574bb5a207a8da6162c42819536e59a0166ff6d59592098b216b4cabed5e9a84ea8c7517c71630bc1e05b25134b97479631498495e849816c39a68c439a9dc0b717dc50dc136b3c7c84997306977b087a8ea3a4d45465ae640faf364fcdefc32d6aefbc8b2bc0530a3195fb38230f4071db3b1a1b002371f26c6b2fb6f019f15a41d7d99ed9ddfbc6ac2b889be3ac8aef74d40b4dc356a7c22c47d94b468a40209b87c5fb27da906cb2c0961df008ba4eb775a7a85def3deef816352962518fc778bb92be27f2da9aa218b453b4043b306fa3d73bde20baea092021fb3b24eefbb8d5ebfba0a80dee83a859352d2bbbd2b21b973e4bf27c6e41c516f24ec407c85897fcf1ef4fd54ef75d3c64eb6fee46948927891310aa8f4e50b1a2ceebc76710b4a18786b33084a1449d30794f938d44185492125bb0dc24a69856583809ba8336ac95ec3893cf65c508dee3820affe4661170818d26d5613a28be393242aa6cc666d9c95f5cbaa150499f418e1871ce824a2acaa802f83753dd83e5810fd4277cc6b92b13481c57e5826c7e2c6b46482879d856407cba843704e47047c8844efe68c215b02cfac454e82666cd926f174e64b37f5cc58338cbb89704c2328e4929e5a9c5b9928a4050920bc414692781afa5c67e6d53121f92863b880f6c91208723dae6bb3993d367aff4c3e42309186fcfb42bb70cfd399fb89a0b8894bcd0a9a15b16820e9ddb6d96eca84394c3ac28bd21c34ba064f55d49ed498317c92b10b0de0889d21f768cbe60e522e60a4ea5be0086e5a0e9cb1c9b8fe5eae51200875e3242791c9c98b5afe9eacd085b8c50da71640d2bf599dfe97e5dd7060ac81eae5ce681250875ad9a10f18603bf436174826fd1b2a6ec576e0f76098695559c5c10b731f8327dfa24423030d6b5a4e2606d973a101bbcab6a2c87f53f5b1fabfc2d57783311e1cf478f80b7a8c81485705c834a49c418592927a87417a14c455b28411b2bf5f82075b45294bb2aa90484be85df2f4d03a28c9acf415607f592f08d91f3e711fb4030382e64f8d8b574723c012ac45990cb98620046f98e7b6eb5ea1e8fea24c39f57442802b77158aa5c18723a974584e31257bdc17116f0710bf1b8e1435e6ce53205d051ff142e349b375dcc4bad57c6d8a413fcf91bc653624be9260a0b4768d364489b4d4bed78babdb9dfabf7a058d6085fab9d720853e807d5d9a3fba8e28d0d9aaeb735bf225aa11f0f2362813810556c1e44a9f32a0686e43ec64065dd9d81c92c563531907688c31cab1f5424312f3cd9c1a69664a1f63acfb87a5b3f98aa1aeb233b96538f1d65b4d07e4b904293bf2733c451fac502118848ff60d5f607060eeea21f0bb3397714761b2652dc7806f8e25b1a71cac99d1231deb4d2b1e1ffa510e2bc0f35837c877044f1e7f823859cf72d9718b3423656303859cd6e9a044cd184e0345b953362a5b32b5352a2ac514aa94795f19b90020d9f4e73fabb6d6bb4efd65e1a91922d3ddcb0ee13f0c336fabd1fd529f9d49be5f93ee81ff55e53ef316a0e307b95906b4e595511ed9fdd1868276341923eac54d60d5c4d2c26bf2777659117ad11b1daf4c42b78d8a7ad527a319d14f231968ad4b544dc937ff5b7f1f148bf00c4c34e62c2eabecf85cb4e012a7d03ae30eb58d5f2fc717deb7db40b8f4e2a87625b7e0fbcb5bed866702c0282f9638afd8fb9dd12a093b771b080d9be69b84d9d5d65277a84f0d0515671446a5d0e4cbb429c9bb7c33147d7a7a7bba9f76d92173b2eabea097bd05f6c590b8d27eb44046cd283b4b2452d63814bfa7992d568dc52f30a45061a480743699c6c59868bef5d1e25797297e7f91a42f50aa102129a69145199a8b8cdaa7f2acc8e0caafe496de211f362e309cc996fa1c158dea062a8a6e29f0d92b13f858c2ec8306275b8b8a15c849981668e7e4d13c9102748ecf917f4cffca2605282fb4936caf6d111422e72bb71704d96a0f0ca8746ce533b5229eb3c7f0ae09779106ccd636f448485d53a035cb87ed880113cc7a62ad724820b82c348f1d86b68e"
        )
        val state3 = Serialization.decrypt(TestConstants.Bob.nodeParams.nodePrivateKey, normal_with_htlcs, TestConstants.Bob.nodeParams)
        assertTrue(state3 is Normal)
    }
}